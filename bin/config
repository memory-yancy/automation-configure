#!/bin/bash

shopt -s dotglob

check_user_id()
{
    [[ $(id -u) = "0" ]] || {
        log_error "please use root privilege to run it again."
        return 1
    }
}

bashrc_config()
{
    log_info "config $HOME/.bashrc option files ..."

    grep -q "^#[[:space:]]*Below followings is generated by os-config-env." "$HOME/.bashrc" || {
        cat >> "${HOME}/.bashrc" <<-EOF
# Below followings is generated by os-config-env.
# User alias setting
[[ -s ~/.bash_aliases ]] && source ~/.bash_aliases

# PS1 and PS2 setting
export PS1="\[\e[31;1m\][\u@\[\e[31;1m\]\h \W]$\[\e[0m\] "
export PS2="... "

export PATH="\$HOME/.cargo/bin:\$PATH"
export HISTCONTROL="ignoredups:erasedups"

# Proxy/VPN setting in command line mode.
# export http_proxy="http://127.0.0.1:8118"
# export https_proxy="https://127.0.0.1:8118"
EOF
    }
}

user_config()
{
    log_info "config related option files ..."

    local all_dot_files="${OS_CONFIG_SRC}/dot-files"
    mkdir -p $HOME/{repo,python,shell,docker,nodejs,dev-tools,database}
    mkdir -p $HOME/{.mutt,.vscode,.shutter}
    cp -rf $all_dot_files/* "$HOME"
}

ROLE="$1"
if [[ "$ROLE" = "root" ]]; then
    check_user_id || exit
fi

bashrc_config || exit
user_config || exit
